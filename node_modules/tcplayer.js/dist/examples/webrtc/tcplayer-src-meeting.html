<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
  <title>腾讯视频云快直播示例</title>
  <!-- 引入播放器 css 文件 -->
  <link href="https://web.sdk.cloud.tencent.cn/player/tcplayer/release/v4.5.3/tcplayer.min.css" rel="stylesheet">
  <script src="https://cdn.bootcdn.net/ajax/libs/vConsole/3.9.1/vconsole.min.js"></script>

  <script src="https://imgcache.qq.com/open/qcloud/video/tcplayer/libs/hls.min.0.13.2m.js"></script>
  <!-- <script src="https://hlsjs.video-dev.org/dist/hls.js"></script> -->
  <!-- <script src="https://cloudcache.tencent-cloud.com/open/qcloud/live/webrtc/js/TXLivePlayer-1.1.0.min.js"></script> -->
  <script src="https://wliap-1306264703.cos.ap-nanjing.myqcloud.com/TXLivePlayer-1.2.0.min.js "></script>
  <!-- 引入播放器 js 文件 -->
  <script src="../../../dist/tcplayer.v4.7.2.js"></script>
  <!-- <script src="https://static.futunn.com/nnlive/lib/js/tcplayer.v4.5.2.min-d98d38ad6c0d398de78b6ad4ae40ba27.js"></script> -->
  <!-- <script src="https://web.sdk.cloud.tencent.cn/player/tcplayer/release/v4.5.3/tcplayer.v4.5.3.min.js"></script> -->

  <!-- 示例 CSS 样式可自行删除 -->
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
    }

    .tcplayer {
      margin: 0 auto;
    }

    @media screen and (max-width: 640px) {

      .tcplayer,
      #player-container-id {
        width: 100%;
        height: 270px;
      }
    }

    /* 设置logo在高分屏的显示样式 */
    @media only screen and (min-device-pixel-ratio: 2),
    only screen and (-webkit-min-device-pixel-ratio: 2) {
      .tcp-logo-img {
        width: 50%;
      }
    }

    .button-container {
      text-align: center;
    }
  </style>
</head>

<body>

  <!-- 设置播放器容器 -->
  <video id="player-container-id" preload="auto" width="640" height="360" playsinline webkit-playsinline>
  </video>
  <!-- <video id="player-native" preload="auto" width="414" height="280" playsinline webkit-playsinline controls 
src="https://5664.liveplay.myqcloud.com/live/5664_harchar1.m3u8?txSecret=f22a813b284137ed10d3259a7b5c224b&txTime=6403f7bb">
</video> -->
  <div class="button-container">
    <!-- <button onclick="playFlv()">flv</button> -->
    <button onclick="playWebRTC()">WebRTC</button>
    <button onclick="playHls()">hls</button>
    <button onclick="playMp4()">mp4</button>
    <button onclick="playFail()">模拟快直播-2005事件，降级播放hls</button>
    <!-- <button onclick="fullscreen()">webkit fullscreen</button> -->
    <!-- <button onclick="fullscreen('#player-native')">fullscreen</button> -->
  </div>
  <!-- <video class="tcplayer" id="player1" preload="auto" width="640" height="360" playsinline webkit-playsinline>
</video> -->
  <!-- <video class="tcplayer" id="player2" preload="auto" width="640" height="360" playsinline webkit-playsinline>
</video> -->
  <script>
    if (TCPlayer.browser.IS_ANDROID || TCPlayer.browser.IS_IOS) {
      const vConsole = new VConsole({ maxLogNumber: 1000 });
    }

    var player = TCPlayer('player-container-id', {
      // 封面图
      // poster: 'https://1256993030.vod2.myqcloud.com/20f8b585vodgzp1256993030/0/player/5285890781393938051.png',
      sources: [/* {
      // 快直播地址
      src: 'webrtc://5664.liveplay.myqcloud.com/live/5664_harchar1?txSecret=f22a813b284137ed10d3259a7b5c224b&txTime=6403f7bb'
    },{
      // HLS直播地址
      src: 'https://5664.liveplay.myqcloud.com/live/5664_harchar1.m3u8?txSecret=f22a813b284137ed10d3259a7b5c224b&txTime=6403f7bb'
    }, */{
          // src: 'https://1256993030.vod2.myqcloud.com/d520582dvodtransgzp1256993030/7732bd367447398157015849771/v.f40.mp4'
          // src: 'https://liveplay.wemeet.tencent.com/trtc_1400143280/stream_18219061098254429397_648623388.m3u8?txTime=62da4bb7&txSecret=BEDDE265B11E30308A254C7E7AD24095'
          // src: 'https://liveplay.futunn.com/live/3159_e8c6d97e97531cd9e552d3805e3b63bb.m3u8?txWMID=173540'
          src: 'https://liveplaydemo.qcloud.com/trtc_1400704311/1400704311_666004_666004_0_main.m3u8?txSecret=6d36db21b33795c07f0de8b283d9f128&txTime=643FD606'
          // src: 'https://5664.liveplay.myqcloud.com/live/5664_harchar1.m3u8?txSecret=f22a813b284137ed10d3259a7b5c224b&txTime=6403f7bb'
        }],
      // 可配置参数说明 https://cloud.tencent.com/document/product/881/30820#options-.E5.8F.82.E6.95.B0.E5.88.97.E8.A1.A8
      controlBar: {
        // 是否显示进度条
        // progressControl:false
      },
      // 
      // nativeControlsForTouch:true,
      webrtcConfig: {
        // 参考 快直播 config 说明
      },
      hlsConfig: {
        // 参考 hls.js config 说明 https://github.com/video-dev/hls.js/blob/f3c6b2712e63ee6ed32957e4035254856d24605e/docs/API.md#fine-tuning
      },
      autoplay: true
    });

    player.on('ready', function () {
      console.log('player on ready');
      // 禁止拖拽进度条 与隐藏进度条不能同时配置。
      // player.controlBar.progressControl.disable();
    });

    player.on('webrtcevent', function (event) {
      console.log('webrtcEvent', event);
    });
    player.on('webrtcfallback', function (event) {
      console.log('webrtcfallback', event);
    });

    // 播放器事件
    var events = [
      'loadstart',
      'suspend',
      'abort',
      'error',
      'emptied',
      'stalled',
      'loadedmetadata',
      'loadeddata',
      'canplay',
      'canplaythrough',
      'playing',
      'waiting',
      'seeking',
      'seeked',
      'ended',
      'durationchange',
      'timeupdate',
      'progress',
      'play',
      'pause',
      'ratechange',
      'resize',
      'volumechange'
    ];
    events.forEach(function (val, i) {
      player.on(val, function (event) {
        console.log(player.currentTime());
        if (val != 'timeupdate') {
          console.log('player event', val);
        }
        if (val === 'waiting') {
          console.log('waiting事件，可以标记为卡顿开始');
        }
        if (val === 'playing') {
          console.log('开始播放或恢复播放，可以标记为卡顿结束');
        }
      });
    });
    // 规避 hls.js 偶现seeking后不触发seeked 的问题
    let timeout
    player.one('seeking', (event) => {
      console.log('on seek');
      timeout = setTimeout(function () {
        player.currentTime(Math.ceil(player.currentTime()));
      }, 500);
      player.one('seeked', (event) => {
        console.log('on seeked', timeout);
        clearTimeout(timeout);
      })
    })

    function playFail() {
      if (player.src().indexOf('webrtc://') === 0) {
        player.tech(true).webrtcProvider && player.tech(true).webrtcProvider.onPlayEvent(-2005);
      }
    }
    function fullscreen(elementID) {
      if (elementID) {
        document.querySelector(elementID).webkitEnterFullScreen();
        return;
      }
      document.querySelector('video').webkitEnterFullScreen();
    }
    function playHls() {
      player.src('https://1256993030.vod2.myqcloud.com/d520582dvodtransgzp1256993030/7732bd367447398157015849771/adp.10.m3u8');
    }
    function playMp4() {
      player.src('https://1256993030.vod2.myqcloud.com/d520582dvodtransgzp1256993030/7732bd367447398157015849771/v.f40.mp4');
    }
    function playWebRTC() {
      player.src('webrtc://5664.liveplay.myqcloud.com/live/5664_harchar1?txSecret=f22a813b284137ed10d3259a7b5c224b&txTime=6403f7bb');
    }
  </script>
</body>

</html>